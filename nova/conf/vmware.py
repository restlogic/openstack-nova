from bees import profiler as p
from oslo_config import cfg
vmware_group = cfg.OptGroup('vmware', title='VMWare Options', help='\nRelated options:\nFollowing options must be set in order to launch VMware-based\nvirtual machines.\n\n* compute_driver: Must use vmwareapi.VMwareVCDriver.\n* vmware.host_username\n* vmware.host_password\n* vmware.cluster_name\n')
vmwareapi_vif_opts = [cfg.StrOpt('integration_bridge', help='\nThis option should be configured only when using the NSX-MH Neutron\nplugin. This is the name of the integration bridge on the ESXi server\nor host. This should not be set for any other Neutron plugin. Hence\nthe default value is not set.\n\nPossible values:\n\n* Any valid string representing the name of the integration bridge\n')]
vmware_utils_opts = [cfg.IntOpt('console_delay_seconds', min=0, help='\nSet this value if affected by an increased network latency causing\nrepeated characters when typing in a remote console.\n'), cfg.StrOpt('serial_port_service_uri', help='\nIdentifies the remote system where the serial port traffic will\nbe sent.\n\nThis option adds a virtual serial port which sends console output to\na configurable service URI. At the service URI address there will be\nvirtual serial port concentrator that will collect console logs.\nIf this is not set, no serial ports will be added to the created VMs.\n\nPossible values:\n\n* Any valid URI\n'), cfg.URIOpt('serial_port_proxy_uri', schemes=['telnet', 'telnets'], help="\nIdentifies a proxy service that provides network access to the\nserial_port_service_uri.\n\nPossible values:\n\n* Any valid URI (The scheme is 'telnet' or 'telnets'.)\n\nRelated options:\nThis option is ignored if serial_port_service_uri is not specified.\n* serial_port_service_uri\n"), cfg.StrOpt('serial_log_dir', default='/opt/vmware/vspc', help="\nSpecifies the directory where the Virtual Serial Port Concentrator is\nstoring console log files. It should match the 'serial_log_dir' config\nvalue of VSPC.\n")]
vmwareapi_opts = [cfg.HostAddressOpt('host_ip', help='\nHostname or IP address for connection to VMware vCenter host.'), cfg.PortOpt('host_port', default=443, help='Port for connection to VMware vCenter host.'), cfg.StrOpt('host_username', help='Username for connection to VMware vCenter host.'), cfg.StrOpt('host_password', secret=True, help='Password for connection to VMware vCenter host.'), cfg.StrOpt('ca_file', help='\nSpecifies the CA bundle file to be used in verifying the vCenter\nserver certificate.\n'), cfg.BoolOpt('insecure', default=False, help='\nIf true, the vCenter server certificate is not verified. If false,\nthen the default CA truststore is used for verification.\n\nRelated options:\n* ca_file: This option is ignored if "ca_file" is set.\n'), cfg.StrOpt('cluster_name', help='Name of a VMware Cluster ComputeResource.'), cfg.StrOpt('datastore_regex', help='\nRegular expression pattern to match the name of datastore.\n\nThe datastore_regex setting specifies the datastores to use with\nCompute. For example, datastore_regex="nas.*" selects all the data\nstores that have a name starting with "nas".\n\nNOTE: If no regex is given, it just picks the datastore with the\nmost freespace.\n\nPossible values:\n\n* Any matching regular expression to a datastore must be given\n'), cfg.FloatOpt('task_poll_interval', default=0.5, help='\nTime interval in seconds to poll remote tasks invoked on\nVMware VC server.\n'), cfg.IntOpt('api_retry_count', min=0, default=10, help='\nNumber of times VMware vCenter server API must be retried on connection\nfailures, e.g. socket error, etc.\n'), cfg.PortOpt('vnc_port', default=5900, help="\nThis option specifies VNC starting port.\n\nEvery VM created by ESX host has an option of enabling VNC client\nfor remote connection. Above option 'vnc_port' helps you to set\ndefault starting port for the VNC client.\n\nPossible values:\n\n* Any valid port number within 5900 -(5900 + vnc_port_total)\n\nRelated options:\nBelow options should be set to enable VNC client.\n* vnc.enabled = True\n* vnc_port_total\n"), cfg.IntOpt('vnc_port_total', min=0, default=10000, help='\nTotal number of VNC ports.\n'), cfg.StrOpt('vnc_keymap', default='en-us', help="\nKeymap for VNC.\n\nThe keyboard mapping (keymap) determines which keyboard layout a VNC\nsession should use by default.\n\nPossible values:\n\n* A keyboard layout which is supported by the underlying hypervisor on\n  this node. This is usually an 'IETF language tag' (for example\n  'en-us').\n"), cfg.BoolOpt('use_linked_clone', default=True, help="\nThis option enables/disables the use of linked clone.\n\nThe ESX hypervisor requires a copy of the VMDK file in order to boot\nup a virtual machine. The compute driver must download the VMDK via\nHTTP from the OpenStack Image service to a datastore that is visible\nto the hypervisor and cache it. Subsequent virtual machines that need\nthe VMDK use the cached version and don't have to copy the file again\nfrom the OpenStack Image service.\n\nIf set to false, even with a cached VMDK, there is still a copy\noperation from the cache location to the hypervisor file directory\nin the shared datastore. If set to true, the above copy operation\nis avoided as it creates copy of the virtual machine that shares\nvirtual disks with its parent VM.\n"), cfg.IntOpt('connection_pool_size', min=10, default=10, help='\nThis option sets the http connection pool size\n\nThe connection pool size is the maximum number of connections from nova to\nvSphere.  It should only be increased if there are warnings indicating that\nthe connection pool is full, otherwise, the default should suffice.\n')]
spbm_opts = [cfg.BoolOpt('pbm_enabled', default=False, help='\nThis option enables or disables storage policy based placement\nof instances.\n\nRelated options:\n\n* pbm_default_policy\n'), cfg.StrOpt('pbm_wsdl_location', help='\nThis option specifies the PBM service WSDL file location URL.\n\nSetting this will disable storage policy based placement\nof instances.\n\nPossible values:\n\n* Any valid file path\n  e.g file:///opt/SDK/spbm/wsdl/pbmService.wsdl\n'), cfg.StrOpt('pbm_default_policy', help='\nThis option specifies the default policy to be used.\n\nIf pbm_enabled is set and there is no defined storage policy for the\nspecific request, then this policy will be used.\n\nPossible values:\n\n* Any valid storage policy such as VSAN default storage policy\n\nRelated options:\n\n* pbm_enabled\n')]
vmops_opts = [cfg.IntOpt('maximum_objects', min=0, default=100, help='\nThis option specifies the limit on the maximum number of objects to\nreturn in a single result.\n\nA positive value will cause the operation to suspend the retrieval\nwhen the count of objects reaches the specified limit. The server may\nstill limit the count to something less than the configured value.\nAny remaining objects may be retrieved with additional requests.\n'), cfg.StrOpt('cache_prefix', help='\nThis option adds a prefix to the folder where cached images are stored\n\nThis is not the full path - just a folder prefix. This should only be\nused when a datastore cache is shared between compute nodes.\n\nNote: This should only be used when the compute nodes are running on same\nhost or they have a shared file system.\n\nPossible values:\n\n* Any string representing the cache prefix to the folder\n')]
ALL_VMWARE_OPTS = vmwareapi_vif_opts + vmware_utils_opts + vmwareapi_opts + spbm_opts + vmops_opts

@p.trace('register_opts')
def register_opts(conf):
    conf.register_group(vmware_group)
    conf.register_opts(ALL_VMWARE_OPTS, group=vmware_group)

@p.trace('list_opts')
def list_opts():
    return {vmware_group: ALL_VMWARE_OPTS}